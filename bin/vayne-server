#!/usr/bin/env node
const {join} = require('path')
const {fork} = require('child_process')

if (!process.env.NODE_ENV) {
  process.env.NODE_ENV = 'development'
}

function resolve (dir) {
  return join(__dirname, '..', dir)
}

function start () {
  const p = fork(resolve('lib/config/server.js'), process.argv.slice(2))
  p.on('message', (data) => {
    if (data === 'RESTART') {
      p.kill('SIGINT')
      start()
    }
  })
}

start()
